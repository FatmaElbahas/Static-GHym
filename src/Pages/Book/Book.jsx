import React, { useState, useMemo, useCallback, useEffect, useRef } from 'react';
import { Helmet } from 'react-helmet-async';
import { Link } from 'react-router-dom';
import { FontAwesomeIcon } from '@fortawesome/react-fontawesome';
import { 
  faSearch, 
  faUsers, 
  faTimes, 
  faRotateLeft,
  faFilter
} from '@fortawesome/free-solid-svg-icons';
import Stats from '../../Components/Stats/Stats';
import Services from '../../Components/Services/Services';
import DoctorCard from '../../Components/DoctorCard/DoctorCard.jsx';
import Logo from '../../assets/images/Logo.png';
import HeroBg from '../../assets/images/hero-bg.ab3138f8.webp';
import HeroBg2 from '../../assets/images/hero2.jpg';
import SidebarFilters from '../../Components/Filter/SidebarFilters.jsx';
import ReactPaginate from 'react-paginate';
import { FilterProvider, useFilter } from '../../context/FilterContext';

// ูููู ุงููุชุงุฆุฌ ุงูุฐู ูุณุชุฎุฏู ุงูููุชุฑ
function SearchResults() {
  const { getDisplayData, isFiltered, filters, filteredData, allData } = useFilter();
  const [page, setPage] = useState(1);
  const doctorsPerPage = 6;
  
  // ุงูุญุตูู ุนูู ุงูุจูุงูุงุช ูู ุงูููุชุฑ
  const displayData = getDisplayData();
  
  // ุฅุนุงุฏุฉ ุชุนููู ุงูุตูุญุฉ ุนูุฏ ุชุบููุฑ ุงูููุงุชุฑ
  useEffect(() => {
    setPage(1);
    console.log('๐ Page reset due to filter change');
    console.log('๐ New filters:', filters);
    console.log('๐ Display data length after filter change:', displayData.length);
  }, [filters, displayData.length]);
  
  // Debug: ุทุจุงุนุฉ ุงูุจูุงูุงุช
  console.log('๐ SearchResults Debug:', {
    isFiltered: isFiltered,
    allDataLength: allData.length,
    filteredDataLength: filteredData.length,
    displayDataLength: displayData.length,
    currentFilters: filters,
    firstItem: displayData[0] ? {
      id: displayData[0].id,
      name: displayData[0].salon_name || displayData[0].owner_name,
      category: displayData[0].salon_categories || displayData[0].category_id
    } : null
  });
  
  const totalPages = Math.ceil(displayData.length / doctorsPerPage);
  
  // ุชูุทูุน ุงููุฑูุช ุญุณุจ ุงูุตูุญุฉ
  const currentDoctors = displayData.slice(
    (page - 1) * doctorsPerPage,
    page * doctorsPerPage
  );
  
  // ุฏุงูุฉ ุชุบููุฑ ุงูุตูุญุฉ
  const handlePageChange = useCallback(({ selected }) => {
    setPage(selected + 1);
  }, []);
  
  return (
    <>
      {/* ุนุฑุถ ุงููุชุงุฆุฌ */}
      {currentDoctors.length > 0 ? (
        <div className="row g-4">
          {currentDoctors.map((doctor, index) => (
            <div key={doctor.id || index} className="col-lg-4 col-md-6">
              <DoctorCard salonData={doctor} />
            </div>
          ))}
        </div>
      ) : (
        <div className="text-center py-5">
          <div className="mb-3">
            <FontAwesomeIcon 
              icon={faSearch} 
              size="3x" 
              className="text-muted"
            />
          </div>
          <div className="h5 text-muted">
            {isFiltered ? 
              "ูู ูุชู ุงูุนุซูุฑ ุนูู ูุชุงุฆุฌ ููููุงุชุฑ ุงููุญุฏุฏุฉ" :
              "ุงุจุญุซ ุนู ุทุจูุจ ุฃู ุนูุงุฏุฉ ููุจุฏุก"
            }
          </div>
          <div className="mt-3">
            <p className="text-muted">
              {isFiltered ? 
                "ุฌุฑุจ ุชุบููุฑ ุงูููุงุชุฑ ุฃู ุฅุนุงุฏุฉ ุชุนููููุง" :
                "ุงุณุชุฎุฏู ูุฑุจุน ุงูุจุญุซ ุฃุนูุงู ููุนุซูุฑ ุนูู ุงูุฃุทุจุงุก ูุงูุนูุงุฏุงุช ุงููุชุงุญุฉ"
              }
            </p>
          </div>
        </div>
      )}

      {/* Pagination */}
      {displayData.length > 0 && totalPages > 1 && (
        <div className="d-flex justify-content-center mt-4" style={{ marginTop: '4rem !important' }}>
          <ReactPaginate
            pageCount={totalPages}
            onPageChange={handlePageChange}
            forcePage={page - 1}
            marginPagesDisplayed={1}
            pageRangeDisplayed={3}
            previousLabel="ุงูุณุงุจู"
            nextLabel="ุงูุชุงูู"
            breakLabel="..."
            containerClassName="pagination"
            pageClassName="page-item"
            pageLinkClassName="page-link"
            previousClassName="page-item"
            nextClassName="page-item"
            activeClassName="active"
            disabledClassName="disabled"
          />
        </div>
      )}
    </>
  );
}

// ูููู ุงูุตูุญุฉ ุงูุฏุงุฎููุฉ ุงูุฐู ูุณุชุฎุฏู ุงูููุชุฑ
function BookContent() {
  const { updateAllData, filters, updateFilters, resetFilters } = useFilter();
  const [activeTab, setActiveTab] = useState("doctor");
  const [searchQuery, setSearchQuery] = useState("");
  const [searchResults, setSearchResults] = useState([]);
  const [isSearching, setIsSearching] = useState(false);
  const [selectedCity, setSelectedCity] = useState("ุงููู");
  const [cities, setCities] = useState([]);
  const [citiesLoading, setCitiesLoading] = useState(false);
  const [isInitialLoad, setIsInitialLoad] = useState(true);
  const [isLoading, setIsLoading] = useState(false);
  const hasLoadedRef = useRef(false);

  // ุฌูุจ ุงููุฏู ูู API
  useEffect(() => {
    const fetchCities = async () => {
      try {
        setCitiesLoading(true);
        console.log('๐ Fetching cities from API...');
        
        const response = await fetch('https://enqlygo.com/api/salons');
        const data = await response.json();
        
        if (data.status === 'success' && data.data) {
          console.log('โ Salons data loaded for cities extraction:', data.data.length);
          
          // ุงุณุชุฎุฑุงุฌ ุงููุฏู ูู ุงูุนูุงููู
          const extractedCities = data.data.map(item => {
            const address = item.salon_address || item.address || '';
            if (typeof address === 'string' && address.trim()) {
                      // ูุงุฆูุฉ ุงููุฏู ุงููุนุฑููุฉ ููุจุญุซ (ุนุฑุจู + ุฅูุฌููุฒู)
                      const knownCities = [
                        'ุงูุฑูุงุถ', 'Riyadh',
                        'ุฌุฏุฉ', 'Jeddah', 
                        'ุงูุฏูุงู', 'Dammam',
                        'ุงููุฏููุฉ ุงููููุฑุฉ', 'Medina',
                        'ุงูุทุงุฆู', 'Taif',
                        'ุงูุฎุจุฑ', 'Khobar',
                        'ุงูุธูุฑุงู', 'Dhahran',
                        'ุงููุงูุฑุฉ', 'Cairo',
                        'ุงููููู', 'Fayoum',
                        'ูุตุฑ ุงูุฌุฏูุฏุฉ', 'New Cairo', 'Heliopolis',
                        'ุงูุฅุณููุฏุฑูุฉ', 'Alexandria'
                      ];
              
              // ุงูุจุญุซ ุนู ุงููุฏููุฉ ูู ุงูุนููุงู
              for (const city of knownCities) {
                if (address.includes(city)) {
                  return city;
                }
              }
              
              // ุฅุฐุง ูู ุชูุฌุฏ ูุฏููุฉ ูุนุฑููุฉุ ูุฃุฎุฐ ุฃูู ุฌุฒุก ูู ุงูุนููุงู
              if (address.includes(' - ')) {
                return address.split(' - ')[0].trim();
              } else if (address.includes('ุ')) {
                return address.split('ุ')[0].trim();
              } else if (address.includes(',')) {
                return address.split(',')[0].trim();
              } else {
                return address.trim();
              }
            }
            return null;
          }).filter(Boolean);
          
          const uniqueCities = [...new Set(extractedCities)];
          console.log('๐๏ธ Extracted cities:', uniqueCities);
          setCities(uniqueCities);
          
          // ุชุนููู ุฃูู ูุฏููุฉ ููููุฉ ุงูุชุฑุงุถูุฉ
          if (uniqueCities.length > 0) {
            setSelectedCity("ุงููู");
          }
        }
      } catch (error) {
        console.error('โ Error fetching cities:', error);
        // ุงุณุชุฎุฏุงู ูุฏู ุงูุชุฑุงุถูุฉ ูู ุญุงูุฉ ุงูุฎุทุฃ
        setCities(['ุงูุฑูุงุถ', 'ุฌุฏุฉ', 'ุงูุฏูุงู']);
      } finally {
        setCitiesLoading(false);
      }
    };

    fetchCities();
  }, []);

  // ุฏุงูุฉ ุงูุจุญุซ ุจุงุณุชุฎุฏุงู API
  const handleSearch = useCallback(async () => {
    // ุงูุณูุงุญ ุจุงูุจุญุซ ุจุงููุฏููุฉ ููุท ุฃู ูุน ุงููุต
    if (!searchQuery.trim() && selectedCity === "ุงููู") {
      alert("ูุฑุฌู ุฅุฏุฎุงู ูููุฉ ุงูุจุญุซ ุฃู ุงุฎุชูุงุฑ ูุฏููุฉ");
      return;
    }

    setIsSearching(true);
    setIsLoading(true);
    try {
      // ุงูุจุญุซ ุญุณุจ ุงููุต ุฃู ุงููุฏููุฉ ุฃู ูููููุง
      let apiUrl = "https://enqlygo.com/api/salons?";
      
      if (searchQuery.trim()) {
        // ุงูุจุญุซ ูู ุงุณู ุงูุทุจูุจ ูุงุณู ุงูุนูุงุฏุฉ ูุนุงู
        const encodedQuery = encodeURIComponent(searchQuery);
        apiUrl += `owner_name=${encodedQuery}&salon_name=${encodedQuery}`;
      }
      
      // ุฅุถุงูุฉ ุงููุฏููุฉ ููุจุญุซ ุฅุฐุง ูู ุชูู "ุงููู"
      if (selectedCity && selectedCity !== "ุงููู") {
        if (searchQuery.trim()) {
          apiUrl += `&city=${encodeURIComponent(selectedCity)}`;
        } else {
          apiUrl += `city=${encodeURIComponent(selectedCity)}`;
        }
      }

      console.log('๐ Searching with URL:', apiUrl);
      const response = await fetch(apiUrl);
      const result = await response.json();
      
      if (result.status === "success" && result.data && result.data.length > 0) {
        let finalResults = result.data;
        
        // ููุชุฑุฉ ูุญููุฉ ุจุงููุฏููุฉ ูู fallback
        if (selectedCity && selectedCity !== "ุงููู") {
          finalResults = finalResults.filter(item => {
            const address = item.salon_address || item.address || '';
            return address.toLowerCase().includes(selectedCity.toLowerCase());
          });
        }
        
        console.log('โ API Search results count:', finalResults.length);
        console.log('๐ API Search results sample:', finalResults.slice(0, 2).map(item => ({
          id: item.id,
          name: item.salon_name || item.owner_name,
          category: item.salon_categories || item.category_id
        })));
        
        if (finalResults.length > 0) {
          setSearchResults(finalResults);
          updateAllData(finalResults);
        } else {
          // ุฅุฐุง ูู ุชูุฌุฏ ูุชุงุฆุฌ ุจุนุฏ ุงูููุชุฑุฉุ ุฌุฑุจ ุงูุจุญุซ ุงููุญูู
          throw new Error('No results after filtering');
        }
        
        // ุชุทุจูู ููุงุชุฑ ุฅุถุงููุฉ ูู ุงูู form
        const newFilte
         = {
          ...filters,
          // ุงูุจุญุซ ูู ุงููุต ุฅุฐุง ูุงู ููุฌูุฏ
          owner_name: searchQuery.trim() ? searchQuery : '',
          salon_name: searchQuery.trim() ? searchQuery : '',
          city: selectedCity && selectedCity !== 'ุงููู' ? selectedCity : ''
        };
        console.log('๐ Applying form filters:', newFilters);
        updateFilters(newFilters);
      } else {
        // ุฅุฐุง ูู ุชูุฌุฏ ูุชุงุฆุฌุ ุฌุฑุจ ุงูุจุญุซ ุงููุญูู ูู fallback
        if (searchQuery.trim()) {
          try {
            console.log('๐ Trying fallback search...');
            const fallbackResponse = await fetch("https://enqlygo.com/api/salons");
            const fallbackResult = await fallbackResponse.json();
            
            if (fallbackResult.status === "success" && fallbackResult.data?.length > 0) {
              const searchTerm = searchQuery.trim().toLowerCase();
              console.log('๐ Searching for:', searchTerm);
              
              const filteredResults = fallbackResult.data.filter(item => {
                const ownerName = (item.owner_name || '').toLowerCase();
                const salonName = (item.salon_name || '').toLowerCase();
                const doctorName = (item.doctor_name || '').toLowerCase();
                const name = (item.name || '').toLowerCase();
                
                const matches = ownerName.includes(searchTerm) || 
                               salonName.includes(searchTerm) || 
                               doctorName.includes(searchTerm) || 
                               name.includes(searchTerm);
                
                if (matches) {
                  console.log('โ Found match:', {
                    id: item.id,
                    owner_name: item.owner_name,
                    salon_name: item.salon_name,
                    doctor_name: item.doctor_name
                  });
                }
                
                return matches;
              });
              
              console.log('๐ Fallback search results:', filteredResults.length);
              
              if (filteredResults.length > 0) {
                setSearchResults(filteredResults);
                updateAllData(filteredResults);
                
                const newFilters = {
                  ...filters,
                  owner_name: searchQuery.trim() ? searchQuery : '',
                  salon_name: searchQuery.trim() ? searchQuery : '',
                  city: selectedCity && selectedCity !== 'ุงููู' ? selectedCity : ''
                };
                updateFilters(newFilters);
                return;
              }
            }
          } catch (fallbackError) {
            console.error("Fallback search failed:", fallbackError);
          }
        }
        
        console.log('โ No search results found');
        setSearchResults([]);
        updateAllData([]);
        alert("ูู ูุชู ุงูุนุซูุฑ ุนูู ูุชุงุฆุฌ");
      }
    } catch (error) {
      console.error("โ ุฎุทุฃ ูู ุงูุจุญุซ:", error);
      
      // ุฅุฐุง ูุงู ุงูุฎุทุฃ ุจุณุจุจ ุนุฏู ูุฌูุฏ ูุชุงุฆุฌุ ุฌุฑุจ ุงูุจุญุซ ุงููุญูู
      if (searchQuery.trim() && (error.message === 'No results after filtering' || error.message.includes('No results'))) {
        try {
          console.log('๐ Trying fallback search due to no results...');
          const fallbackResponse = await fetch("https://enqlygo.com/api/salons");
          const fallbackResult = await fallbackResponse.json();
          
          if (fallbackResult.status === "success" && fallbackResult.data?.length > 0) {
            const searchTerm = searchQuery.trim().toLowerCase();
            console.log('๐ Fallback searching for:', searchTerm);
            
            const filteredResults = fallbackResult.data.filter(item => {
              const ownerName = (item.owner_name || '').toLowerCase();
              const salonName = (item.salon_name || '').toLowerCase();
              const doctorName = (item.doctor_name || '').toLowerCase();
              const name = (item.name || '').toLowerCase();
              
              const matches = ownerName.includes(searchTerm) || 
                             salonName.includes(searchTerm) || 
                             doctorName.includes(searchTerm) || 
                             name.includes(searchTerm);
              
              if (matches) {
                console.log('โ Fallback found match:', {
                  id: item.id,
                  owner_name: item.owner_name,
                  salon_name: item.salon_name,
                  doctor_name: item.doctor_name
                });
              }
              
              return matches;
            });
            
            console.log('๐ Fallback search results:', filteredResults.length);
            
            if (filteredResults.length > 0) {
              setSearchResults(filteredResults);
              updateAllData(filteredResults);
              
              const newFilters = {
                ...filters,
                owner_name: searchQuery.trim() ? searchQuery : '',
                salon_name: searchQuery.trim() ? searchQuery : '',
                city: selectedCity && selectedCity !== 'ุงููู' ? selectedCity : ''
              };
              updateFilters(newFilters);
              return;
            }
          }
        } catch (fallbackError) {
          console.error("Fallback search failed:", fallbackError);
        }
      }
      
      alert("ุญุฏุซ ุฎุทุฃ ุฃุซูุงุก ุงูุจุญุซ");
    } finally {
      setIsSearching(false);
      setIsLoading(false);
    }
  }, [searchQuery, activeTab, selectedCity, filters, updateAllData, updateFilters]);

  // ุฏุงูุฉ ุฌูุจ ุฌููุน ุงูุฃุทุจุงุก ูู API
  const fetchAllDoctors = useCallback(async () => {
    if (hasLoadedRef.current) {
      console.log('โญ๏ธ Skipping fetchAllDoctors - already loaded');
      return; // ุชุฌูุจ ุงูุงุณุชุฏุนุงุก ุงููุชูุฑุฑ
    }
    
    try {
      hasLoadedRef.current = true;
      setIsInitialLoad(true);
      setIsLoading(true);
      
      console.log('๐ Fetching all doctors from API...');
      const response = await fetch("https://enqlygo.com/api/salons");
      const result = await response.json();
      
      if (result.status === "success" && result.data && result.data.length > 0) {
        console.log('โ All doctors count:', result.data.length);
        console.log('๐ All doctors sample:', result.data.slice(0, 2).map(item => ({
          id: item.id,
          name: item.salon_name || item.owner_name,
          category: item.salon_categories || item.category_id
        })));
        
        setSearchResults(result.data);
        // ุชุญุฏูุซ ุงูุจูุงูุงุช ูู ุงูููุชุฑ
        updateAllData(result.data);
      } else {
        console.log('โ No doctors found in API response');
      }
    } catch (error) {
      console.error("โ ุฎุทุฃ ูู ุฌูุจ ุงูุฃุทุจุงุก:", error);
      hasLoadedRef.current = false; // ุฅุนุงุฏุฉ ุชุนููู ูู ุญุงูุฉ ุงูุฎุทุฃ
    } finally {
      setIsInitialLoad(false);
      setIsLoading(false);
    }
  }, [updateAllData]);

  // ุฏุงูุฉ ุฅุนุงุฏุฉ ุชุนููู ุงูุจุญุซ
  const resetSearch = useCallback(async () => {
    console.log('๐ Resetting search...');
    setSearchQuery("");
    setSelectedCity("ุงููู");
    setSearchResults([]);
    hasLoadedRef.current = false; // ุนุดุงู ูุณูุญ ุจุฌูุจ ุงูุจูุงูุงุช ุชุงูู
    
    try {
      setIsLoading(true);
      console.log('๐ Fetching all doctors again from API...');
      const response = await fetch("https://enqlygo.com/api/salons");
      const result = await response.json();
      
      if (result.status === "success" && result.data && result.data.length > 0) {
        console.log('โ Doctors reset - count:', result.data.length);
        setSearchResults(result.data);
        updateAllData(result.data);
        
        // ุฅุนุงุฏุฉ ุชุนููู ุงูููุงุชุฑ
        updateFilters({
          owner_name: '',
          salon_name: '',
          city: ''
        });
      } else {
        console.log('โ No doctors found in reset');
        setSearchResults([]);
        updateAllData([]);
      }
    } catch (error) {
      console.error('โ Error resetting search:', error);
      alert("ุญุฏุซ ุฎุทุฃ ุฃุซูุงุก ุฅุนุงุฏุฉ ุชุญููู ุงูุฃุทุจุงุก");
    } finally {
      setIsLoading(false);
    }
  }, [updateAllData, updateFilters]);

  // ุฏุงูุฉ ุนุฑุถ ุฌููุน ุงูุฃุทุจุงุก
  const showAllDoctors = useCallback(async () => {
    console.log('๐ Showing all doctors...');
    setSearchQuery("");
    setSelectedCity("ุงููู");
    setError(null);
    
    // ุฅุนุงุฏุฉ ุชุนููู searchResults ูุนุฑุถ ุฌููุน ุงูุจูุงูุงุช
    setSearchResults([]);
    
    // ุฅุนุงุฏุฉ ุชุนููู hasLoadedRef ููุณูุงุญ ุจุฅุนุงุฏุฉ ุฌูุจ ุงูุจูุงูุงุช
    hasLoadedRef.current = false;
    
    try {
      setIsLoading(true);
      console.log('๐ Fetching all doctors from API...');
      const response = await fetch("https://enqlygo.com/api/salons");
      const result = await response.json();
      
      if (result.status === "success" && result.data && result.data.length > 0) {
        console.log('โ All doctors count:', result.data.length);
        
        // ุชุญุฏูุซ ุงูุจูุงูุงุช ูู ุงูููุชุฑ ูุจุงุดุฑุฉ
        updateAllData(result.data);
        
        // ุฅุนุงุฏุฉ ุชุนููู ุฌููุน ุงูููุงุชุฑ
        resetFilters();
        
        // ุชุนููู hasLoadedRef
        hasLoadedRef.current = true;
        
        console.log('โ All doctors displayed successfully');
      } else {
        console.log('โ No doctors found in API response');
        setError('ูู ูุชู ุงูุนุซูุฑ ุนูู ุฃุทุจุงุก');
      }
    } catch (error) {
      console.error('โ Error fetching all doctors:', error);
      setError('ุญุฏุซ ุฎุทุฃ ูู ุฌูุจ ุงูุจูุงูุงุช');
    } finally {
      setIsLoading(false);
    }
  }, [updateAllData, resetFilters]);


  // ุฌูุจ ุงูุฃุทุจุงุก ูู API ุนูุฏ ุชุญููู ุงูุตูุญุฉ (ูุฑุฉ ูุงุญุฏุฉ ููุท)
  useEffect(() => {
    console.log('๐ useEffect triggered - checking if need to fetch doctors');
    console.log('๐ hasLoadedRef.current:', hasLoadedRef.current);
    if (!hasLoadedRef.current) {
      console.log('โ Calling fetchAllDoctors...');
      fetchAllDoctors();
    } else {
      console.log('โญ๏ธ Skipping fetchAllDoctors - already loaded');
    }
  }, []); // dependency array ูุงุฑุบ ูุถูุงู ุงูุชูููุฐ ูุฑุฉ ูุงุญุฏุฉ ููุท
  
  return (
    <>
      <Helmet>
        <title>ุจูุณูู | blsmy</title>
        <meta name="description" content="ูุฑูุฒ ุจูุณูู ุงูุทุจู ููุฏู ุฎุฏูุงุช ุทุจูุฉ ูุชุทูุฑุฉ ูุนูุงุฌุงุช ุฌูุฏูุฉ ูุชุฎุตุตุฉ. ุงุญุฌุฒ ููุนุฏู ุงูุขู ูุงุณุชูุฏ ูู ุฎุฏูุงุชูุง ุงููุชููุฒุฉ" />
        <meta name="keywords" content="ูุฑูุฒ ุทุจู, ุฎุฏูุงุช ุฌูุฏูุฉ, ุนูุงุฌุงุช ุทุจูุฉ, ุญุฌุฒ ููุนุฏ, ุจูุณูู, ุตุญุฉ" />
        <meta property="og:title" content="ุจูุณูู | blsmy" />
        <meta property="og:description" content="ูุฑูุฒ ุจูุณูู ุงูุทุจู ููุฏู ุฎุฏูุงุช ุทุจูุฉ ูุชุทูุฑุฉ ูุนูุงุฌุงุช ุฌูุฏูุฉ ูุชุฎุตุตุฉ" />
        <meta property="og:type" content="website" />
      </Helmet>
      
      <div className="book-page position-relative">
        <section className="hero-section position-relative mb-0" style={{height: '60vh'}} dir="rtl">
          <div id="heroCarousel" className="carousel slide h-100" data-bs-ride="carousel" data-bs-interval="5000">
            <div className="carousel-inner h-100">

              {/* Slide 1 */}
              <div className="carousel-item active h-100">
                <div
                  className="hero-background position-absolute top-0 start-0 w-100 h-100"
                  style={{
                    backgroundImage: `url(${HeroBg})`,
                    backgroundRepeat: 'no-repeat',
                    backgroundSize: 'cover',
                    backgroundPosition: 'center center',
                  }}
                >
                  <div className="hero-overlay position-relative h-100 d-flex align-items-start justify-content-end">
                    <div className="hero-text " style={{ paddingTop: '8%', paddingRight:'15%' }}>
                      <h1 className="brand-name color-main fw-bold mb-3" style={{ fontSize: '3.5rem', textShadow: '0 2px 4px rgba(0,0,0,0.2)' }}>
                        ุงุญุฌุฒ ููุนุฏู ุจุณูููุฉ
                      </h1>
                      <p className="text-white fs-5 fw-medium pe-0" style={{ maxWidth: '500px' }}>
                        ูุฑูููุง ุงูุทุจู ุงููุชุฎุตุต ูู ุฎุฏูุชู ุนูู ูุฏุงุฑ ุงูุณุงุนุฉ
                      </p>
                    </div>
                  </div>
                </div>
              </div>

              {/* Slide 2 */}
              <div className="carousel-item h-100">
                <div
                  className="hero-background position-absolute top-0 start-0 w-100 h-100"
                  style={{
                    backgroundImage: `url(${HeroBg})`,
                    backgroundRepeat: 'no-repeat',
                    backgroundSize: 'cover',
                    backgroundPosition: 'center center',
                  }}
                >
                  <div className="hero-overlay position-relative h-100 d-flex align-items-start justify-content-end">
                    <div className="hero-text " style={{ paddingTop: '8%',  paddingRight:'15%'  }}>
                      <h1 className="brand-name color-main fw-bold mb-3" style={{ fontSize: '3.5rem', textShadow: '0 2px 4px rgba(0,0,0,0.2)' }}>
                        ุฏูุงุชุฑู ูุชููุฒุฉ ูุฑุงุฆุฏุฉ
                      </h1>
                      <p className="text-white fs-5 fw-medium pe-0" style={{ maxWidth: '500px' }}>
                        ุงุญุตูู ุนูู ุฃูุถู ุฑุนุงูุฉ ุตุญูุฉ ูุน ุฃุญุฏุซ ุงูุฃุฌูุฒุฉ ุงูุทุจูุฉ ูุงูุฎุจุฑุฉ ุงูููุชุงุฒุฉ
                      </p>
                    </div>
                  </div>
                </div>
              </div>

            </div>

           

            {/* Indicators */}
            <div className="carousel-indicators position-absolute bottom-0 start-50 translate-middle-x mb-3">
              <button type="button" data-bs-target="#heroCarousel" data-bs-slide-to="0" className="active bg-main" aria-current="true" aria-label="Slide 1"></button>
              <button type="button" data-bs-target="#heroCarousel" data-bs-slide-to="1" aria-label="Slide 2"></button>
            </div>
          </div>
        </section>

        <section className="booking-form-section w-full py-1">
      <div className="container">
      <div className="row justify-content-center">
        <div className="col-12" style={{ maxWidth: '100%' }}>
            <div className="booking-form-card bg-white h-full rounded-pill shadow-lg p-4 w-full" 
                 style={{ 
                   marginTop: "-220px", 
                   position: "relative", 
                   zIndex: "10",
                   border: '1px solid rgba(0,0,0,0.05)',
                   backdropFilter: 'blur(10px)',
                   background: 'rgba(255, 255, 255, 0.95)',
                   borderRadius: '60px',
                   boxShadow: '0 15px 35px rgba(0,0,0,0.1), 0 5px 15px rgba(0,0,0,0.07)'
                 }}
               dir="rtl">

            {/* All Elements in One Row */}
            <div className="row g-0 align-items-center" style={{minHeight: '50px'}}>
              {/* Doctor Name / Specialty */}
              <div className="col-lg-6 col-md-6 col-sm-12 d-flex align-items-center" style={{paddingRight: '8px'}}>
                <input
                  type="text"
                  className="form-control w-100"
                  value={searchQuery}
                  onChange={(e) => setSearchQuery(e.target.value)}
                  placeholder="ุงุจุญุซ ุจุงูุงุณู ุฃู ุงุฎุชุฑ ุงููุฏููุฉ ุฃู ูููููุง..."
                  onKeyPress={(e) => e.key === 'Enter' && handleSearch()}
                  style={{ 
                    height: '50px', 
                    padding: '15px 25px',
                    fontSize: '1rem',
                    boxShadow: '0 2px 4px rgba(0,0,0,0.08)',
                    borderRadius: '8px',
                    border: '1px solid #e0e0e0',
                    transition: 'all 0.3s ease'
                  }}
                  onMouseEnter={(e) => {
                    e.target.style.borderColor = 'var(--color-main)';
                    e.target.style.boxShadow = '0 3px 8px rgba(3, 143, 173, 0.15)';
                  }}
                  onMouseLeave={(e) => {
                    e.target.style.borderColor = '#e0e0e0';
                    e.target.style.boxShadow = '0 2px 4px rgba(0,0,0,0.08)';
                  }}
                />
              </div>

              {/* City Select */}
              <div className="col-lg-2 col-md-2 col-sm-6 d-flex align-items-center" style={{paddingRight: '8px'}}>
                <div className="position-relative w-100">
                  <select 
                    className="form-select w-100"
                    value={selectedCity}
                    onChange={(e) => setSelectedCity(e.target.value)}
                    disabled={citiesLoading}
                    style={{ 
                      height: '50px', 
                      padding: '15px 25px',
                      fontSize: '1rem',
                      boxShadow: '0 2px 4px rgba(0,0,0,0.08)',
                      borderRadius: '8px',
                      border: '1px solid #e0e0e0',
                      transition: 'all 0.3s ease',
                      backgroundImage: `url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 16 16'%3e%3cpath fill='%23038fad' d='m4.427 9.427 3.396 3.396a.25.25 0 0 0 .354 0l3.396-3.396A.25.25 0 0 0 11.396 9H4.604a.25.25 0 0 0-.177.427Z'/%3e%3c/svg%3e")`,
                      backgroundRepeat: 'no-repeat',
                      backgroundPosition: 'right 5px center',
                      backgroundSize: '24px 20px',
                      paddingRight: '55px'
                    }}
                    onMouseEnter={(e) => {
                      e.target.style.borderColor = 'var(--color-main)';
                      e.target.style.boxShadow = '0 3px 8px rgba(3, 143, 173, 0.15)';
                    }}
                    onMouseLeave={(e) => {
                      e.target.style.borderColor = '#e0e0e0';
                      e.target.style.boxShadow = '0 2px 4px rgba(0,0,0,0.08)';
                    }}
                  >
                    {citiesLoading ? (
                      <option value="" disabled>ุฌุงุฑู ุชุญููู ุงููุฏู...</option>
                    ) : (
                      <>
                        <option value="ุงููู" style={{color: 'var(--color-main)'}}>ุฌููุน ุงููุฏู</option>
                        {cities.map((city, index) => (
                          <option key={index} value={city} style={{color: 'var(--color-main)'}}>
                            {city}
                          </option>
                        ))}
                      </>
                    )}
                  </select>
                </div>
              </div>

              {/* Buttons Section */}
              <div className="col-lg-4 col-md-4 col-sm-12 d-flex justify-content-center align-items-center" style={{padding: '2px 8px'}}>
                <div className="d-flex align-items-center gap-2">
              {/* Search Button */}
                <button 
                    className="btn btn-primary bg-main border-0"
                  onClick={handleSearch}
                  disabled={isSearching || isLoading}
                    title="ุจุญุซ"
                  style={{ 
                      height: '45px', 
                      fontSize: '0.9rem',
                    fontWeight: '500',
                    boxShadow: '0 3px 6px rgba(0,0,0,0.15)',
                      borderRadius: '8px',
                      transition: 'all 0.3s ease',
                      padding: '0 30px',
                      minWidth: '140px'
                    }}
                    onMouseEnter={(e) => {
                      e.target.style.backgroundColor = '#027a8a';
                      e.target.style.transform = 'translateY(-2px)';
                      e.target.style.boxShadow = '0 5px 15px rgba(0,0,0,0.2)';
                    }}
                    onMouseLeave={(e) => {
                      e.target.style.backgroundColor = 'var(--color-main)';
                      e.target.style.transform = 'translateY(0)';
                      e.target.style.boxShadow = '0 3px 6px rgba(0,0,0,0.15)';
                  }}
                >
                  {isSearching || isLoading ? (
                    <>
                        <span className="spinner-border spinner-border-sm me-1" role="status" aria-hidden="true"></span>
                      ุฌุงุฑู ุงูุจุญุซ...
                    </>
                  ) : (
                    <>
                        <FontAwesomeIcon icon={faSearch} className="me-1" />
                      ุจุญุซ
                    </>
                  )}
                </button>
                  
                  {/* Show All Doctors Button */}
                    <button 
                      className="btn btn-outline-primary"
                      onClick={showAllDoctors}
                      disabled={isLoading}
                    title="ุนุฑุถ ุฌููุน ุงูุฃุทุจุงุก"
                      style={{ 
                      width: '50px',
                        height: '50px', 
                        fontSize: '1rem',
                        fontWeight: '500',
                        boxShadow: '0 3px 6px rgba(0,0,0,0.15)',
                      borderRadius: '50%',
                      borderColor: 'var(--color-main)',
                      color: 'var(--color-main)',
                      transition: 'all 0.3s ease',
                      display: 'flex',
                      alignItems: 'center',
                      justifyContent: 'center'
                    }}
                    onMouseEnter={(e) => {
                      e.target.style.backgroundColor = 'var(--color-main)';
                      e.target.style.color = 'white';
                    }}
                    onMouseLeave={(e) => {
                      e.target.style.backgroundColor = 'transparent';
                      e.target.style.color = 'var(--color-main)';
                      }}
                    >
                      {isLoading ? (
                        <>
                        <span className="spinner-border spinner-border-sm" role="status" aria-hidden="true"></span>
                        </>
                      ) : (
                        <>
                        <FontAwesomeIcon icon={faUsers} />
                        </>
                      )}
                    </button>
                  
                  {/* Reset Search Button */}
                  <button 
                    className="btn btn-outline-secondary"
                    onClick={resetSearch}
                    disabled={isLoading}
                    title="ุฅุนุงุฏุฉ ุชุนููู ุงูุจุญุซ"
                    style={{ 
                      width: '50px',
                      height: '50px', 
                      fontSize: '1rem',
                      fontWeight: '500',
                      boxShadow: '0 3px 6px rgba(0,0,0,0.15)',
                      borderRadius: '50%',
                      borderColor: 'var(--color-main)',
                      color: 'var(--color-main)',
                      transition: 'all 0.3s ease',
                      display: 'flex',
                      alignItems: 'center',
                      justifyContent: 'center'
                    }}
                    onMouseEnter={(e) => {
                      e.target.style.backgroundColor = 'var(--color-main)';
                      e.target.style.color = 'white';
                    }}
                    onMouseLeave={(e) => {
                      e.target.style.backgroundColor = 'transparent';
                      e.target.style.color = 'var(--color-main)';
                    }}
                  >
                    <FontAwesomeIcon icon={faRotateLeft} />
                  </button>
                </div>
              </div>
            </div>
                
                {/* ูุณุงูุฉ ุจุนุฏ ุงูุฃุฒุฑุงุฑ */}
                <div className="mt-3"></div>
              </div>
          </div>
        </div>
      </div>
        </section>
      </div>

      {/* Booking Form Section */}
      <div className="book-page container-fluid" style={{paddingBlock:'50px', marginTop: '80px' }} dir="rtl">
        <style>{`
          .btn-outline-primary:hover,
          .btn-outline-secondary:hover {
            background: linear-gradient(135deg, var(--color-main), #027a8a) !important;
            border-color: var(--color-main) !important;
            color: white !important;
            transform: translateY(-2px) !important;
            box-shadow: 0 6px 20px rgba(3, 143, 173, 0.4) !important;
          }
          
          .btn-primary:hover {
            background: linear-gradient(135deg, #027a8a, #015f6b) !important;
            transform: translateY(-2px) !important;
            box-shadow: 0 6px 20px rgba(3, 143, 173, 0.5) !important;
          }
          
          .btn {
            transition: all 0.3s ease !important;
            backdrop-filter: blur(5px) !important;
          }
          
          .btn-primary {
            background: linear-gradient(135deg, var(--color-main), #027a8a) !important;
            border: none !important;
            box-shadow: 0 4px 12px rgba(3, 143, 173, 0.3) !important;
          }
          
          .btn-outline-primary,
          .btn-outline-secondary {
            background: rgba(255, 255, 255, 0.9) !important;
            backdrop-filter: blur(5px) !important;
            border: 1px solid rgba(3, 143, 173, 0.3) !important;
            box-shadow: 0 2px 8px rgba(3, 143, 173, 0.1) !important;
          }
          
          /* ุชุฎุตูุต ุฃููููุฉ ุงูู select */
          .form-select {
            -webkit-appearance: none !important;
            -moz-appearance: none !important;
            appearance: none !important;
          }
          
          /* ุชูุญูุฏ ูุธูุฑ ุงูู inputs */
          .form-control,
          .form-select {
            height: 50px !important;
            border-radius: 8px !important;
            border: 1px solid #e8e8e8 !important;
            transition: all 0.3s ease !important;
            background-color: rgba(255, 255, 255, 0.9) !important;
            backdrop-filter: blur(5px) !important;
            padding: 15px 25px !important;
            font-size: 1rem !important;
            line-height: 1.5 !important;
            box-sizing: border-box !important;
            box-shadow: 0 2px 4px rgba(0,0,0,0.08) !important;
          }
          
          .form-control:focus,
          .form-select:focus {
            border-color: var(--color-main) !important;
            box-shadow: 0 0 0 0.2rem rgba(3, 143, 173, 0.15) !important;
            background-color: rgba(255, 255, 255, 1) !important;
          }
          
          .form-control:hover,
          .form-select:hover {
            border-color: var(--color-main) !important;
            box-shadow: 0 3px 8px rgba(3, 143, 173, 0.15) !important;
          }
          
          /* ุชุญุณูู ุงูุชุฎุทูุท ููุดุงุดุงุช ุงูุตุบูุฑุฉ */
          @media (max-width: 768px) {
            .booking-form-card .row {
              margin: 0;
            }
            
            .booking-form-card .col-sm-12,
            .booking-form-card .col-sm-6,
            .booking-form-card .col-sm-3 {
              margin-bottom: 10px;
              padding-right: 8px !important;
            }
          }
          
          /* ุชุญุณูู ุงูุชุฎุทูุท ููุดุงุดุงุช ุงููุชูุณุทุฉ */
          @media (max-width: 992px) {
            .booking-form-card .col-md-3,
            .booking-form-card .col-md-4,
            .booking-form-card .col-md-5 {
              padding-right: 8px !important;
            }
          }
          
          /* ุชุญุณูู ุงูุชุฎุทูุท ููุดุงุดุงุช ุงููุจูุฑุฉ */
          @media (min-width: 992px) {
            .booking-form-card .col-lg-4,
            .booking-form-card .col-lg-5 {
              padding-right: 8px !important;
            }
          }
          
          /* ุชุญุณูู ูุธูุฑ ุงูู form */
          .booking-form-card {
            background: linear-gradient(135deg, rgba(255,255,255,0.95), rgba(248,250,252,0.95)) !important;
            border: 1px solid rgba(3, 143, 173, 0.1) !important;
            box-shadow: 0 20px 40px rgba(0,0,0,0.15), 0 8px 16px rgba(3, 143, 173, 0.1) !important;
            border-radius: 60px !important;
          }
          
          /* ุชุญุณูู ุงููุตูุต */
          .form-control::placeholder {
            color: #94a3b8 !important;
            font-weight: 400 !important;
          }
          
          .form-select {
            color: #334155 !important;
            font-weight: 500 !important;
          }
          
          /* ุชุฎุตูุต ูุธูุฑ ุงูู options */
          .form-select option {
            color: var(--color-main) !important;
            background-color: white !important;
            font-weight: 500 !important;
          }
          
          .form-select option:hover,
          .form-select option:focus,
          .form-select option:active {
            background-color: var(--color-main) !important;
            color: white !important;
            background: var(--color-main) !important;
            background-image: none !important;
          }
          
          /* ุชุฌุงูุฒ ุฃููู ููู hover */
          .form-select option:hover {
            background: var(--color-main) !important;
            background-color: var(--color-main) !important;
            color: white !important;
          }
          
          .form-select option:checked,
          .form-select option[selected] {
            background-color: var(--color-main) !important;
            color: white !important;
            background: var(--color-main) !important;
          }
          
          .form-select option:checked:hover,
          .form-select option[selected]:hover {
            background-color: var(--color-main) !important;
            color: white !important;
            background: var(--color-main) !important;
          }
          
          /* ุชุฌุงูุฒ ุฃููุงู ุงููุชุตูุญ ุงูุงูุชุฑุงุถูุฉ */
          .form-select option::-moz-selection {
            background-color: var(--color-main) !important;
            color: white !important;
          }
          
          .form-select option::selection {
            background-color: var(--color-main) !important;
            color: white !important;
          }
          
          /* ุชุฌุงูุฒ ุฃููู ูููุชุตูุญุงุช ุงููุฎุชููุฉ */
          .form-select option:hover {
            background: var(--color-main) !important;
            background-color: var(--color-main) !important;
            color: white !important;
            -webkit-appearance: none !important;
            -moz-appearance: none !important;
            appearance: none !important;
          }
          
          /* ุชุฌุงูุฒ ุฎุงุต ูู Chrome ู Safari */
          .form-select option:hover::-webkit-option {
            background: var(--color-main) !important;
            color: white !important;
          }
          
          /* ุชุฌุงูุฒ ุฎุงุต ูู Firefox */
          .form-select option:hover::-moz-option {
            background: var(--color-main) !important;
            color: white !important;
          }
          
          /* ูุญุงุฐุงุฉ ุงูู sidebar ูุงูู cards ูู ุงูุดุงุดุงุช ุงููุจูุฑุฉ */
          @media (min-width: 992px) {
            .sidebar-filters {
              height: fit-content;
              min-height: 100%;
            }
            
            .sidebar-filters .bg-white {
              height: 100%;
              min-height: 100vh;
            }
          }
        `}</style>
        <div className="row align-items-start">
          {/* Sidebar */}
          <SidebarFilters />
          {/* Doctor List */}
          <main className="col-lg-9 col-md-8">
      {/* Search Results Message - Hidden */}
      {false && !isLoading && !isInitialLoad && searchResults.length > 0 && (
        <div className="alert alert-info mb-4" role="alert">
          <i className="fas fa-info-circle me-2"></i>
          {searchQuery ? 
            `ุชู ุงูุนุซูุฑ ุนูู ${searchResults.length} ูุชูุฌุฉ ููุจุญุซ ุนู: "${searchQuery}"` :
            `ุนุฑุถ ${searchResults.length} ุทุจูุจ ูุนูุงุฏุฉ ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช`
          }
        </div>
      )}
      
      <div className="row g-4">
        {isLoading || isInitialLoad ? (
          // Loading state ุดุงูู
          <div className="col-12 text-center py-5">
            <div className="spinner-border text-primary mb-3" role="status" style={{width: '3rem', height: '3rem'}}>
              <span className="visually-hidden">ุฌุงุฑู ุงูุชุญููู...</span>
            </div>
            <h5 className="text-muted mb-2">
              {isInitialLoad ? 'ุฌุงุฑู ุชุญููู ุงูุฃุทุจุงุก...' : 'ุฌุงุฑู ุงูุจุญุซ...'}
            </h5>
            <p className="text-muted">
              {isInitialLoad ? 'ูุฑุฌู ุงูุงูุชุธุงุฑ ููููุงู' : 'ูุจุญุซ ุนู ุฃูุถู ุงููุชุงุฆุฌ ูู'}
            </p>
          </div>
        ) : !isLoading && !isInitialLoad ? (
          // ุงุณุชุฎุฏุงู ูููู ุงููุชุงุฆุฌ ุงูุฌุฏูุฏ
          <SearchResults key={`search-results-${JSON.stringify(filters)}`} />
        ) : null}
      </div>

          </main>
        </div>
      </div>
    </>
  );
}

// ุงููููู ุงูุฑุฆูุณู ุงูุฐู ูุญุชูู ุนูู FilterProvider
export default function Book() {
  return (
    <FilterProvider>
      <BookContent />
    </FilterProvider>
  );
}
